---
layout: post
title: "[UnityPerformanceTurningBible] 2.1 CPU&GPU"
---

## 📖 今日の記事  
[UnityPerformanceTuningBible](https://github.com/CyberAgentGameEntertainment/UnityPerformanceTuningBible/releases/tag/v1.0.5)

---

## 🗒️ 単語

| 単語           | 意味      | 文章                                                                                                             |
| ------------ | ------- | -------------------------------------------------------------------------------------------------------------- |
| 局所性(きょくしょせい) | 국소성     | ゲームエンジンにおいてはデータの局 所性を意識したメモリ管理は難しいですが<br><br>데이터가 메모리상에서 흩어져 있지 않고 연속적으로 모여있도록, 캐시 메모리에 잘 배치해서 성능을 올리고 싶다는 맥락. |


---

## 💡 インサイト

- CPU 内部での命令が処理する流れをパイプラインと呼び、パイプラインの中で次の 命令を予測しながら処理されています。次の命令がもし予測されていない場合は、==パ イプライン・ストール(pipeline stall)==と呼ばれる一時停止が発生し一度リセットされます。ストール する原因の大部分は分岐処理です。
	- CPU의 명령 처리 방식: 순차적이나 가끔 분기문 처리하다 꼬이면, pipe stall 이라고 하는 일시정지가 발생하기도 함.
- CPU の演算能力は、==クロック周波数(Clock Frequency)==（単位は Hz）と==コア数(Core)==で決定されます。クロッ ク周波数は **1 秒間に何回 CPU が動作できるか**を表します。そのためクロック周波数 が高ければ高いほどプログラムの実行速度は速いです。 一方でコア数は、**CPU の並列演算能力**に寄与します。コアは CPU の動作する基本 単位で、それが複数ある場合はマルチコアと呼ばれています。
	- CPU의 연산 속도는 클럭주파수, 코어 수로 결정되며, 클럭은 초간 CPU가 몇 회 일하는지, 코어 수는 병렬연산과 관련된 것.
- 近年のマルチコア（とくにスマートフォン向け）は==非対称コア（big.LITTLE）==を搭載 する CPU が主流となってきました。非対称コアとは、**高性能コアと省電力コアを一緒 に搭載しているような CPU** を指します。非対称コアのメリットは**普段は省電力コアの みを動かして電池消費を節約**し、**ゲームなどパフォーマンスを出さないといけない時 にコアを切り替えて使える**というところです。ただし省電力コアの分、並列性能の最大値は低下するので、コア数だけでは判断できないことに注意が必要です。
	- 스마트폰은 주로 비대칭 코어가 탑재되어있는데, 평소에는 소전력코어로 일을 하다가, 게임 같은 퍼포먼스를 내야 하는 일들은 고성능 코어에서 처리한다.
- またプログラムが複数のコアを使い切れるかどうかは、プログラムの並列処理の記 述に依存します。たとえばゲームエンジン側で物理エンジンを別スレッドで動作させ るなどの効率化してあるケースや、Unity の JobSystem などを通じて並列処理を活用 しているケースもありますが、ゲームのメインループ自体の動作は並列化できないた め、マルチコアであってもコア自体の性能は高いほうが有利です。
	- 코어를 어떻게 사용할지 등은 프로그램에 기재된 코드에 의존하는데, 각 기능별 처리할 코어들을 일일히 지정해 관리하는 것이 어렵기 때문에 Unity의 JobSystem같은 거 사용해서 일부 처리한다.
- **CPU とメインメモリは物理的に離れた場所に存在**し、アクセスするためにほんの僅 かな時間（レイテンシ）が必要になります。そのためプログラムを実行する際にメイ ンメモリに格納されたデータにアクセスしようとすると、この距離が性能の大きなボ トルネックとなります。そこでこのレイテンシの問題を解決するために、**CPU 内部に はキャッシュメモリが搭載**されています。==キャッシュメモリ(Cache Memory)==は、主に**メインメモリに 格納されているデータの一部を格納することで、プログラムが必要とするデータに素 早くアクセスできるよう**にします。
	- CPU와 메인 메모리는 떨어진 곳에 위치하므로, 메인메모리에 접근하는데 많은 비용이 발생해서 메인 메모리의 일부 메모리를 CPU안의 Cache메모리 영역에 일부 탑재해서 사용한다.

| CPU                                                                   | GPU                                                      |
| --------------------------------------------------------------------- | -------------------------------------------------------- |
| ある座標の RGB 値をメモリか ら読み取り、<br>グレースケール(GreyScale)に変換して<br>メモリに戻す処理を画素毎に実行 | それぞれの画素の計算は<br>他の画素の結 果に依存しないので、<br>各画素における計算を並列で行うことが容易 |
| 複雑な命令を逐次計算するコアが少数                                                     | 簡単な命令を同時に計算するコアが大量                                       |
| 소수의 고성능 코어 느낌                                                         | 다수의 단순 코어 느낌                                             |
|                                                                       | 浮動小数点演算が得意                                               |
- ただしモバイルにおいては、GPU 専用のメモリを搭載するのではなく、**メインメモ リを CPU と GPU で共用するアーキテクチャが一般的**です。これは GPU のメモリ容 量を動的に変えることができるメリットがある一方で、転送帯域を CPU と GPU で シェアするというデメリットがあります。